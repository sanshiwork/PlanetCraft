<!DOCTYPE html>
<html>
<head>
    <title>Game with WebSocket Demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            color: #000;
            font-family: monospace;
            font-size: 13px;
            text-align: center;
            font-weight: bold;

            background-color: #fff;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
<div id="container">
</div>
<script src="libs/three.min.js"></script>
<script src="libs/stats.min.js"></script>
<script src="libs/dat.gui.min.js"></script>
<script type="text/javascript">

    var camera, scene, renderer, stats;
    var gui;
    var controls = new function () {
        this.color = 0x000000;
    };
    var rayCaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();

    initGui();
    init();
    animate();

    function initGui() {
        gui = new dat.GUI();
        gui.addColor(controls, 'color').onChange(function (e) {
            console.log(e);
        });
    }

    function init() {
        // 相机
        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(0, 2, 0);
        camera.lookAt(new THREE.Vector3(0, 0, 0));

        // 场景
        scene = new THREE.Scene();

        // 辅助线
        // scene.add(new THREE.AxesHelper(20));

        var light = new THREE.PointLight(0xffffff, 1);
        light.position.set(0, 50, 0);
        scene.add(light);

        // 平面几何体
        var geometry = new THREE.PlaneGeometry(20, 10, 512, 256);
        geometry.rotateX(-Math.PI / 2);

        var material = new THREE.MeshLambertMaterial({
            vertexColors: THREE.FaceColors,
            // wireframe: true,
            // side: THREE.DoubleSide
        });
        scene.add(new THREE.Mesh(geometry, material));

        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(0xeeeeee);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        var container = document.getElementById('container');
        container.appendChild(renderer.domElement);

        stats = new Stats();
        container.appendChild(stats.dom);

        // 在容器上注册事件，这里container也可以换成document
        container.addEventListener('click', onMouseDown, false);

        window.addEventListener('resize', onWindowResize, false);

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);

    }

    function onMouseDown(event) {

        mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
        mouse.y = -( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

        rayCaster.setFromCamera(mouse, camera);

        var intersects = rayCaster.intersectObjects(scene.children);
        if (intersects.length > 0) {
            console.log(intersects[0]);
            for (var i = 0; i < intersects[0].object.geometry.faces.length; i++) {
                intersects[0].face.color.set(controls.color);
                intersects[0].object.geometry.colorsNeedUpdate = true;
            }
        }
    }

    function animate() {
        requestAnimationFrame(animate);
        stats.update();
        render();

    }

    function render() {
        renderer.render(scene, camera);
    }
</script>
<script src="libs/game.js"></script>
</body>
</html>